<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î | Product App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        /* ============================= */
        /* CSS Theme */
        /* ============================= */
        :root {
            --primary-color: #4CAF50;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-radius: 8px;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏ô‡∏π */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
        }

        .nav-links {
            margin-bottom: 20px;
        }

        .nav-links a {
            text-decoration: none;
            color: #666;
            margin: 0 10px;
            font-size: 14px;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--primary-color);
            font-weight: 600;
        }

        /* ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ */
        .search-wrapper {
            max-width: 500px;
            margin: 0 auto 30px auto;
            position: relative;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid #ddd;
            border-radius: 30px; /* ‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô‡∏£‡∏µ */
            font-family: 'Kanit', sans-serif;
            font-size: 16px;
            outline: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s;
            box-sizing: border-box;
        }

        input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.2);
        }

        /* Grid ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ */
        .product-grid {
            display: grid;
            /* ‡∏à‡∏±‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î 200px) */
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÉ‡∏ö */
        .product-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .product-img {
            width: 100%;
            height: 180px;
            object-fit: cover; /* ‡∏ï‡∏±‡∏î‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏£‡∏≠‡∏ö */
            background-color: #eee;
            border-bottom: 1px solid #f0f0f0;
        }

        .product-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .product-code {
            font-size: 12px;
            color: #888;
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 5px;
            width: fit-content;
        }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            margin: 5px 0;
            color: #333;
        }

        .product-price {
            font-size: 18px;
            color: var(--primary-color);
            font-weight: bold;
            margin-top: 10px;
        }

        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Loading / ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        .status-msg {
            text-align: center;
            grid-column: 1 / -1; /* ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏ñ‡∏ß */
            color: #666;
            margin-top: 20px;
            font-size: 18px;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>
            <div class="nav-links">
                <a href="/">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a> |
                <a href="/search">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™</a> |
                <a href="/del">‚ùå ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
            </div>
        </header>

        <div class="search-wrapper">
            <input type="text" 
                   id="searchInput" 
                   placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á...">
        </div>

        <div id="productList" class="product-grid">
            <div class="status-msg">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </div>
    </div>

    <script>
        let products = [];
        const productListEl = document.getElementById("productList");
        const searchInput = document.getElementById("searchInput");

        // -----------------------------
        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        // -----------------------------
        async function loadProducts() {
            try {
                const response = await fetch("/api/products");
                if(!response.ok) throw new Error("Load failed");
                
                products = await response.json();
                renderProducts(products);
            } catch (error) {
                productListEl.innerHTML = `<div class="status-msg" style="color:red;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ</div>`;
            }
        }

        // -----------------------------
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Render)
        // -----------------------------
        function renderProducts(list) {
            productListEl.innerHTML = "";

            if (list.length === 0) {
                productListEl.innerHTML = `<div class="status-msg">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>`;
                return;
            }

            list.forEach(p => {
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ placeholder
                const imgHtml = p.image_url 
                    ? `<img src="${p.image_url}" class="product-img" loading="lazy">`
                    : `<div class="product-img" style="display:flex;align-items:center;justify-content:center;color:#999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>`;

                const html = `
                    <div class="product-card">
                        ${imgHtml}
                        <div class="product-info">
                            <div>
                                <span class="product-code">${p.product_code}</span>
                                <div class="product-name">${p.name}</div>
                            </div>
                            <div class="product-price">${parseFloat(p.price).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                    </div>
                `;
                productListEl.innerHTML += html;
            });
        }

        // -----------------------------
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Filter)
        // -----------------------------
        searchInput.addEventListener("input", function () {
            const keyword = searchInput.value.toLowerCase().trim();

            const filtered = products.filter(p => 
                p.product_code.toLowerCase().includes(keyword) ||
                p.name.toLowerCase().includes(keyword)
            );

            renderProducts(filtered);
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        loadProducts();
    </script>

</body>
</html>